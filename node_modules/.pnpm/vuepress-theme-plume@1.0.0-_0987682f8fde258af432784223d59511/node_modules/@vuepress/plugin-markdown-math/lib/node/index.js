import{loadMhchem as k,katex as y}from"@mdit/plugin-katex-slim";import{createMathjaxInstance as $,mathjax as g}from"@mdit/plugin-mathjax-slim";import{ensureEndingSlash as w,Logger as f,getModulePath as M,isModuleAvailable as u,addCustomElement as v}from"@vuepress/helper";import{path as C,getDirname as E,logger as c,colors as p}from"vuepress/utils";const F=import.meta.dirname||E(import.meta.url),h=w(C.resolve(F,"../client")),d="@vuepress/plugin-markdown-math";new f(d);const I=async(a,n,i)=>{let o="";return n==="katex"?o+=`import "${M("katex/dist/katex.min.css",import.meta)}";
import "${h}styles/katex.css";
${i.copy?`import { useKatexCopy } from "${h}composables/useKatexCopy.js";

export default {
  setup: () => {
    useKatexCopy();
  }
};
`:""}`:o+=`import './mathjax.css';
`,a.writeTemp("markdown-math/config.js",o)},L=`mjx-container {
  overflow: auto hidden;
}

mjx-assistive-mml {
  display: none;
}
`,P=async(a,n)=>{await a.writeTemp("markdown-math/mathjax.css",`${n.outputStyle()}
${L}`)},b=({type:a,...n}={})=>{const i=u("@mathjax/src",import.meta),o=u("katex",import.meta),r=a==="katex"&&o?"katex":a==="mathjax"&&i||i?"mathjax":o?"katex":null;if(!r||a&&r!==a){const e={katex:"katex",mathjax:"@mathjax/src"};return c.error(r?`type is "${a}", but "${e[a]}" is not installed`:"No math renderer found, please install @mathjax/src or katex"),{name:d}}let s;return{name:d,extendsBundlerOptions:(e,t)=>{r==="mathjax"&&v(e,t,/^mjx-/)},extendsMarkdown:async e=>{r==="mathjax"?(s=await $({...n,transformer:t=>t.replace(/^<mjx-container/,"<mjx-container v-pre")}),e.use(g,s),e.use(t=>{const x=t.render.bind(t);t.render=(l,m)=>{const j=x(l,m);return s?.reset(),j}})):(n.mhchem&&await k(),e.use(y,{logger:(t,x,l,{filePathRelative:m})=>{t!=="newLineInDisplayMode"&&(t==="unicodeTextInMathMode"?c.warn(`Found unicode character ${l.text} inside tex${m?` in ${p.cyan(m)}`:""}. You should use ${p.magenta(`\\text{${l.text}}`)}`):c.warn(`${x}.${m?`
Found in ${p.cyan(m)}`:""}`))},...n,transformer:t=>t.replace(/^(<[a-z]+ )/g,"$1v-pre ")}))},onPrepared:async e=>{r==="mathjax"&&(await P(e,s),e.env.isBuild&&(s=null))},clientConfigFile:e=>I(e,r,n)}};export{b as markdownMathPlugin};
//# sourceMappingURL=index.js.map
